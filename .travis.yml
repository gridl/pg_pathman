os:
  - linux

sudo: required
dist: trusty

language: c

services:
    - docker

install:
    - sed -e 's/${CC}/'${CC}/g -e 's/${PG_VERSION}/'${PG_VERSION}/g Dockerfile.tmpl  > Dockerfile
    - docker-compose build

script:
    - docker-compose run tests

env:
    - PG_VERSION=10  CHECK_CODE=true CC=clang
    - PG_VERSION=10  CHECK_CODE=false CC=clang
    - PG_VERSION=9.6 CHECK_CODE=true CC=clang
    - PG_VERSION=9.6 CHECK_CODE=false CC=clang
    - PG_VERSION=9.5 CHECK_CODE=true CC=clang
    - PG_VERSION=9.5 CHECK_CODE=false CC=clang
    - PG_VERSION=10  CHECK_CODE=true CC=gcc
    - PG_VERSION=10  CHECK_CODE=false CC=gcc
    - PG_VERSION=9.6 CHECK_CODE=true CC=gcc
    - PG_VERSION=9.6 CHECK_CODE=false CC=gcc
    - PG_VERSION=9.5 CHECK_CODE=true CC=gcc
    - PG_VERSION=9.5 CHECK_CODE=false CC=gcc

after_success:
  - bash <(curl -s https://codecov.io/bash)
